{% macro _render_plugin(entry) %}
  <div class="col-md-3 col-sm-6 col-xs-12">
    <div class="small-box bg-{{ entry.color|default('green') }} box box-solid">
      <div class="inner">
        <h3>{{ entry.display_name }}</h3>
        <p>By {{ entry.author }}</p>
        {{ _render_tags(entry.tags) }}
        {{ _render_button(entry.is_installed|default(False),
                          entry.name,
                          entry.url,
                          entry.namespace,
                          entry.method|default('git'),
                          entry.options) }}
      </div>
      <div class="icon">
        <i class="fa fa-{{ entry.icon|default('gears') }}"></i>
      </div>
      <a href="{{ entry.homepage or '#' }}" class="small-box-footer" target="_blank">
        More info <i class="fa fa-arrow-circle-right"></i>
      </a>
      <div class="overlay {% if not entry.on_installation %}hidden{% endif %}" id="{{ entry.name }}">
        <i class="fa fa-refresh fa-spin"></i>
      </div>
    </div>
  </div>
{% endmacro %}

{% macro _render_tags(tags) %}
  {% for tag in tags %}
    <span>
      <small class="label label-default">
        <i class="fa fa-tag"></i>
        {{ tag }}
      </small>
      &nbsp;
    </span>
  {% endfor %}
{% endmacro %}

{% macro _render_button(is_installed, plugin_name, url, namespace, method, options) %}
  <button type="button" class="btn btn-default btn-xs margin label" style="z-index:1;position:relative;"
    data-installed="{{ is_installed }}"
    data-name="{{ plugin_name }}"
    data-url="{{ url }}"
    data-namespace="{{ namespace }}"
    data-method="git"
    data-options='{{ options|tojson if options }}'
    {% if not is_installed %}
      data-install-url="{{ url_for('plugin.PluginView:install_plugin') }}"
    {% else %}
      data-remove-url="{{ url_for('plugin.PluginView:remove_plugin') }}"
    {% endif %}
  >
  {% if is_installed %}
    Remove
    <i class="fa fa-trash"></i>
  {% else %}
    Install
    <i class="fa fa-download"></i>
  {% endif %}
  </button>
{% endmacro %}

<div class="row">
  {% for entry in market %}
    {{ _render_plugin(entry) }}
  {% endfor %}
</div>
